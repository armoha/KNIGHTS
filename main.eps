
const L_ANYWHERE = $L("Anywhere");
const L_MAIN = $L("main");

const U_HERO = 61;

const c_hero = PVariable();

function CreateCUnit(unitType, playerID, location) : CUnit {
	const newUnit = CUnit.from_read(EPD(0x628438));
	CreateUnit(1, unitType, location, playerID);
	return newUnit;
}

function onPluginStart() {
    EUDPlayerLoop()();
        const PID = getcurpl();
        if (Command(PID, AtLeast, 1, U_HERO)) {
            MoveLocation(L_MAIN, U_HERO, PID, L_ANYWHERE);
            RemoveUnit(U_HERO, PID);
            c_hero[PID] = CreateCUnit(U_HERO, PID, L_MAIN);
            // setup
            const unit = CUnit(c_hero[PID]);
            //unit.topSpeed = 8000;
            CenterView(L_MAIN);
        }
    EUDEndPlayerLoop();
}

function beforeTriggerExec() {
    
}

function afterTriggerExec() {
    EUDPlayerLoop()();
        const PID = getcurpl();
        const unit = CUnit(c_hero[PID]);
        unit.topSpeed = 2000;
        eprintf("{}", unit.topSpeed);
    EUDEndPlayerLoop();
}